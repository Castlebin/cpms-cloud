<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cpms.system.modules.sys.mapper.SysMenuMapper">
    <!-- 通用查询映射结果 -->
    <resultMap id="menuResultMap" type="com.cpms.system.modules.sys.entity.SysMenuEntity">
        <id column="menu_id" property="menuId"/>
        <result column="code" property="code"/>
        <result column="parent_id" property="parentId"/>
        <result column="name" property="name"/>
        <result column="alias" property="alias"/>
        <result column="path" property="path"/>
        <result column="sort" property="sort"/>
        <result column="type" property="type"/>
        <result column="open_flag" property="openFlag"/>
        <result column="del_flag" property="delFlag"/>
        <result column="icon" property="icon"/>
        <result column="component" property="component"/>
    </resultMap>

    <select id="queryRoleMenus" resultMap="menuResultMap">
        select *
        from cpms_system_menu
        where del_flag = 0 and type =#{type}
        and menu_id IN
        ( SELECT menu_id FROM cpms_system_role_menu WHERE type = 0 and  role_id IN
        <foreach collection="list" index="index" item="item" open="(" separator="," close=")">
            #{item}
        </foreach>
         )
    </select>

<!--    <select id="queryRoleButtonsTree" resultMap="menuResultMap">-->
<!--        SELECT *-->
<!--        FROM cpms_system_menu-->
<!--        WHERE del_flag = 0 AND menu_id-->
<!--        IN(SELECT parent_id FROM cpms_system_menu WHERE TYPE=1 AND menu_id IN-->
<!--           (-->
<!--           SELECT menu_id FROM cpms_system_role_user WHERE role_id IN-->
<!--            <foreach collection="list" index="index" item="item" open="(" separator="," close=")">-->
<!--                #{item}-->
<!--            </foreach>-->
<!--           )-->
<!--        )-->
<!--        UNION ALL-->
<!--        SELECT *-->
<!--        FROM cpms_system_menu-->
<!--        WHERE del_flag = 0 AND  TYPE=1 AND menu_id-->
<!--        IN (-->
<!--           SELECT menu_id FROM cpms_system_role_user WHERE role_id IN-->
<!--            <foreach collection="list" index="index" item="item" open="(" separator="," close=")">-->
<!--                #{item}-->
<!--            </foreach>-->
<!--        )-->
<!--    </select>-->

    <select id="queryRoleButtons" resultType="java.lang.String">
        SELECT code
        FROM cpms_system_menu
        WHERE del_flag = 0 AND  TYPE = 1
        AND menu_id
        IN (
        SELECT menu_id FROM cpms_system_role_menu WHERE type = 0 and role_id IN
        <foreach collection="list" index="index" item="item" open="(" separator="," close=")">
            #{item}
        </foreach>
        )
    </select>
</mapper>