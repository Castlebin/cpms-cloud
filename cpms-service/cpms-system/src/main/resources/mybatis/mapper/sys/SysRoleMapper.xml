<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cpms.system.modules.sys.mapper.SysRoleMapper">

    <select id="queryRoleByUserId" parameterType="java.lang.Long" resultType="com.cpms.system.modules.sys.entity.SysRoleEntity">
        SELECT r.role_name,r.role_id,r.role_code,role_desc,ru.user_id
        FROM  cpms_system_role r,cpms_system_role_user ru
        WHERE ru.role_id= r.role_id AND r.del_flag=0 AND ru.user_id = #{userId};
    </select>

    <select id="listRoleCount" parameterType="com.cpms.system.modules.sys.dto.QueryRoleDTO" resultType="java.lang.Integer">
        SELECT
        count(1)
        FROM  cpms_system_role r
        LEFT JOIN
        cpms_system_tenant t
        ON t.tenant_id = r.tenant_id
        <where>
            r.del_flag = 0
            <if test="roleName !=null and roleName !=''">
                and r.role_name like CONCAT('%',#{roleName},'%' )
            </if>
            <if test="roleCode !=null and roleCode !=''">
                and r.role_code= #{roleCode}
            </if>
            <if test="tenantId !=null">
                and r.tenant_id = #{tenantId}
            </if>
        </where>
    </select>

    <select id="listRole" parameterType="com.cpms.system.modules.sys.dto.QueryRoleDTO" resultType="com.cpms.system.modules.sys.vo.SysRoleVO">
         SELECT
         r.role_name,
         r.role_id,
         r.role_code,
         r.role_desc,
         r.role_sort,
         r.create_time,
         r.update_time,
         r.create_by,
         r.update_by,
         t.tenant_id,
         t.tenant_name
         FROM  cpms_system_role r
         LEFT JOIN
         cpms_system_tenant t
         ON t.tenant_id = r.tenant_id
         <where>
             r.del_flag = 0
             <if test="roleName !=null and roleName !=''">
                 and r.role_name like CONCAT('%',#{roleName},'%' )
             </if>
             <if test="roleCode !=null and roleCode !=''">
                 and r.role_code= #{roleCode}
             </if>
             <if test="tenantId !=null">
                 and r.tenant_id = #{tenantId}
             </if>
         </where>
         ORDER BY r.role_sort ASC
         LIMIT #{startIndex},#{pageSize}
    </select>
</mapper>